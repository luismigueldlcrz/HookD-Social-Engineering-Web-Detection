<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scanner | Astra</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="scanner-style.css">
</head>
<body class="scanner-bg">

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top pt-4">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="index.html">
                <div class="logo-icon me-2"></div> Astra
            </a>
            <div class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav gap-4">
                    <li class="nav-item"><a class="nav-link" href="index.html">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#">About</a></li>
                </ul>
            </div>
            
            <a href="account.html" style="text-decoration: none; color: inherit;">
                <div class="profile-pill">
                    <img src="user-avatar.jpg" alt="Profile" class="profile-avatar me-2">
                    <span class="profile-name">Juana Miguel</span>
                </div>
            </a>
        </div>
    </nav>

    <main class="container mt-5 pt-5">
        <h1 class="display-3 fw-bold mb-4 mt-5">Phishing Scanner</h1>

        <ul class="nav nav-tabs scanner-nav-tabs border-0" id="scannerTab" role="tablist">
            <li class="nav-item"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#text-pane">Text Scanner</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#link-pane">Link Scanner</button></li>
            <li class="nav-item"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#image-pane">Image Scanner</button></li>
        </ul>

        <div class="scanner-main-wrap mb-4">
            <div class="scanner-left-box tab-content" id="scannerTabContent">
                
                <div class="tab-pane fade show active" id="text-pane" role="tabpanel">
                    <textarea class="scanner-field" placeholder="Insert Text Here"></textarea>
                    <div class="d-flex justify-content-end align-items-center p-4 gap-4">
                        <i data-lucide="trash-2" class="icon-action"></i>
                        <button class="btn btn-scan rounded-pill px-5" onclick="performScan()">SCAN</button>
                    </div>
                </div>

                <div class="tab-pane fade" id="link-pane" role="tabpanel">
                    <textarea class="scanner-field" placeholder="Enter URL to scan..."></textarea>
                    <div class="d-flex justify-content-end align-items-center p-4 gap-4">
                        <i data-lucide="trash-2" class="icon-action"></i>
                        <button class="btn btn-scan rounded-pill px-5" onclick="performScan()">SCAN</button>
                    </div>
                </div>

                <div class="tab-pane fade" id="image-pane" role="tabpanel">
                    <div class="upload-frame">
                        <div class="upload-icon-no-border mb-3">
                            <i data-lucide="image-up" width="140" height="140" stroke-width="1.2" color=var(--astra-green)></i>
                        </div>
                        <button class="btn btn-upload rounded-pill px-5 mb-2" onclick="performScan()">Upload</button>
                        <p class="small opacity-50">Accepted formats: .jpg, .png</p>
                    </div>
                </div>
            </div>
            
            <div class="scanner-right-glass d-none d-md-block">
                <div id="scanIdleState" class="h-100 d-flex flex-column align-items-center justify-content-center opacity-25">
                    <i data-lucide="scan-line" style="width: 64px; height: 64px;"></i>
                    <p class="mt-3 fw-bold">Ready to Scan</p>
                </div>

                <div id="scanLoadingState" class="h-100 d-flex flex-column align-items-center justify-content-center d-none">
                    <div class="spinner-border text-astra-green mb-3" role="status"></div>
                    <p class="small text-muted">Analyzing patterns...</p>
                </div>

                <div id="scanResultState" class="h-100 d-flex flex-column align-items-center justify-content-center d-none">
                    <div id="rightStatusWrapper" class="status-wrapper">
                        <div class="status-icon-circle">
                            <i id="rightStatusIcon" data-lucide="check"></i>
                        </div>
                        <h2 id="rightStatusText" class="status-label">SAFE</h2>
                        <span class="confidence-text">100% Confidence</span>
                        <div class="status-progress-bg">
                            <div class="status-progress-bar" style="width: 100%;"></div>
                        </div>
                    </div>
                    <p id="rightStatusDesc" class="text-center small px-4 opacity-75 mt-3">
                        No malicious patterns detected.
                    </p>
                </div>
            </div>
        </div>

        <div class="disclaimer-bar mb-5">
            This detection engine provides probabilistic results based on trained patterns; it should be used as a supplementary defense rather than a definitive security guarantee.
        </div>

        <div class="history-section pb-5">
            <h2 class="display-5 fw-bold mb-4">Scan History</h2>
            <div class="row g-4">
                
                <div class="col-md-4">
                    <div class="history-card p-4" onclick="openModal('safe', 'Scan 1', 'Oct 24, 2:30 PM')">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <h5 class="history-title mb-0" id="cardTitle1">Scan 1</h5>
                                <i data-lucide="pencil" class="edit-trigger-icon" onclick="enableCardEdit(event, 'cardTitle1')"></i>
                            </div>
                            <span class="status-text" style="color:var(--status-safe)">Safe</span>
                        </div>
                        <p class="history-preview mt-3">Lorem ipsum dolor sit amet, consectetur adipiscing elit...</p>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="history-card p-4" onclick="openModal('caution', 'Scan 2', 'Oct 23, 11:15 AM')">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <h5 class="history-title mb-0" id="cardTitle2">Scan 2</h5>
                                <i data-lucide="pencil" class="edit-trigger-icon" onclick="enableCardEdit(event, 'cardTitle2')"></i>
                            </div>
                            <span class="status-text" style="color:var(--status-caution)">Caution</span>
                        </div>
                        <p class="history-preview mt-3">Warning: This link redirects to a suspicious domain...</p>
                    </div>
                </div>

                <div class="col-md-4">
                    <div class="history-card p-4" onclick="openModal('unsafe', 'Scan 3', 'Oct 22, 9:45 AM')">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <div class="d-flex align-items-center gap-2">
                                <h5 class="history-title mb-0" id="cardTitle3">Scan 3</h5>
                                <i data-lucide="pencil" class="edit-trigger-icon" onclick="enableCardEdit(event, 'cardTitle3')"></i>
                            </div>
                            <span class="status-text" style="color:var(--status-unsafe)">Unsafe</span>
                        </div>
                        <p class="history-preview mt-3">CRITICAL: Malicious payload detected...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div id="scanModal" class="modal-overlay d-none">
        <div class="modal-glass-panel">
            <button class="close-modal-btn" onclick="closeModal()">
                <i data-lucide="x"></i>
            </button>
            
            <div id="modalStatusWrapper" class="status-wrapper">
                <div class="status-icon-circle"><i id="modalStatusIcon" data-lucide="check"></i></div>
                <h2 id="modalStatusText" class="status-label">SAFE</h2>
                <span class="confidence-text">100% Confidence</span>
                <div class="status-progress-bg"><div class="status-progress-bar" style="width: 100%;"></div></div>
            </div>

            <div class="modal-body-text text-start mt-4">
                <div class="d-inline-flex align-items-center gap-2 mb-1">
                    <h4 id="modalTitleDisplay" class="modal-scan-title mb-0">Scan Title</h4>
                    <i data-lucide="pencil" class="edit-trigger-icon" onclick="enableTitleEdit()"></i>
                </div>
                
                <p id="modalDateDisplay" class="small text-muted mb-3">Date Placeholder</p>
                <div class="full-text-scroll">
                    <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Pellentesque efficitur scelerisque varius. Aenean sagittis eros velit, vel volutpat libero consectetur et. Morbi a mi eu urna porttitor semper.</p> 
                    <p>Donec consectetur, lacus nec congue hendrerit, sem nisi porttitor erat, eget maximus dolor risus id erat. Aliquam eu ex eu ex laoreet sodales.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();

        // 1. SCAN LOGIC
        function performScan() {
            const idle = document.getElementById('scanIdleState');
            const loading = document.getElementById('scanLoadingState');
            const result = document.getElementById('scanResultState');
            
            idle.classList.add('d-none');
            result.classList.add('d-none');
            loading.classList.remove('d-none');

            setTimeout(() => {
                loading.classList.add('d-none');
                const states = ['safe', 'caution', 'unsafe'];
                const randomState = states[Math.floor(Math.random() * states.length)];
                updateRightPanel(randomState);
                result.classList.remove('d-none');
            }, 1500);
        }

        function updateRightPanel(state) {
            const wrapper = document.getElementById('rightStatusWrapper');
            const icon = document.getElementById('rightStatusIcon');
            const text = document.getElementById('rightStatusText');
            const desc = document.getElementById('rightStatusDesc');
            
            wrapper.className = 'status-wrapper';
            
            if (state === 'safe') {
                wrapper.classList.add('state-safe');
                text.innerText = "SAFE";
                desc.innerText = "No malicious patterns detected.";
                icon.setAttribute('data-lucide', 'check');
            } else if (state === 'caution') {
                wrapper.classList.add('state-caution');
                text.innerText = "CAUTION";
                desc.innerText = "Suspicious patterns detected.";
                icon.setAttribute('data-lucide', 'alert-triangle');
            } else if (state === 'unsafe') {
                wrapper.classList.add('state-unsafe');
                text.innerText = "UNSAFE";
                desc.innerText = "High-risk threat detected!";
                icon.setAttribute('data-lucide', 'x');
            }
            lucide.createIcons();
        }

        // 2. MODAL LOGIC
        function openModal(state, title, date) {
            const modal = document.getElementById('scanModal');
            const wrapper = document.getElementById('modalStatusWrapper');
            const iconEl = document.getElementById('modalStatusIcon');
            const textEl = document.getElementById('modalStatusText');
            
            wrapper.className = 'status-wrapper ' + 'state-' + state;
            
            if (state === 'safe') {
                textEl.innerText = "SAFE";
                iconEl.setAttribute('data-lucide', 'check');
            } else if (state === 'caution') {
                textEl.innerText = "CAUTION";
                iconEl.setAttribute('data-lucide', 'alert-triangle');
            } else if (state === 'unsafe') {
                textEl.innerText = "UNSAFE";
                iconEl.setAttribute('data-lucide', 'x');
            }

            document.getElementById('modalTitleDisplay').innerText = title;
            document.getElementById('modalDateDisplay').innerText = date;

            lucide.createIcons();
            modal.classList.remove('d-none');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('scanModal').classList.add('d-none');
            document.body.style.overflow = 'auto';
        }

        // 3. EDIT LOGIC (FIXED)
        function enableTitleEdit() {
            const titleEl = document.getElementById('modalTitleDisplay');
            
            // Toggle editability
            titleEl.contentEditable = "true";
            titleEl.focus(); // Must focus immediately
            titleEl.classList.add('editing-active'); // Add visual class
            
            const saveEdit = () => { 
                titleEl.contentEditable = "false"; 
                titleEl.classList.remove('editing-active');
            };
            
            // Save on blur (click away) or Enter
            titleEl.addEventListener('blur', saveEdit, { once: true });
            titleEl.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') { 
                    e.preventDefault(); 
                    titleEl.blur(); 
                }
            });
        }

        function enableCardEdit(event, elementId) {
            event.stopPropagation();
            const titleEl = document.getElementById(elementId);
            titleEl.contentEditable = "true";
            titleEl.focus();
            titleEl.style.borderBottom = "1px solid var(--astra-green)";
            
            titleEl.addEventListener('blur', () => {
                titleEl.contentEditable = "false";
                titleEl.style.borderBottom = "none";
            }, { once: true });
            
            titleEl.addEventListener('keydown', (e) => {
                if(e.key === 'Enter') { 
                    e.preventDefault(); 
                    titleEl.blur(); 
                }
            });
        }
        
        // Force Large Icon
        lucide.createIcons({
            attrs: { width: 140, height: 140, 'stroke-width': 1.2, color: 'white' },
            nameAttr: 'data-lucide-large' 
        });
        const upIcon = document.querySelector('.upload-icon-no-border i');
        if(upIcon) { upIcon.setAttribute('width', '140'); upIcon.setAttribute('height', '140'); }
    </script>
</body>
</html>