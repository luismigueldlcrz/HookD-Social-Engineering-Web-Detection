<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HookD | Scanner</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/scanner-style.css') }}">
</head>
<body class="scanner-bg">

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top pt-4">
        <div class="container">
            <a class="navbar-brand fw-bold d-flex align-items-center" href="{{ url_for('index') }}">
                <div class="logo-icon me-2"></div> HookD
            </a>
            
            <div class="collapse navbar-collapse justify-content-center">
                <ul class="navbar-nav gap-4">
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('index') }}">Home</a></li>
                    <li class="nav-item"><a class="nav-link active" href="{{ url_for('dashboard') }}">Scanner</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('history') }}">History</a></li>
                    <li class="nav-item"><a class="nav-link" href="{{ url_for('about') }}">About</a></li>
                </ul>
            </div>
            
            <div class="dropdown">
                <a href="#" class="profile-trigger dropdown-toggle" id="profileDropdown" data-bs-toggle="dropdown" aria-expanded="false">
                    <div class="profile-pill">
                        <div class="rounded-circle d-flex align-items-center justify-content-center me-2" 
                             style="width: 32px; height: 32px; background: #000; border: 1px solid #c1ff72; color: #c1ff72; font-weight: 700; font-size: 0.9rem;">
                            {{ user.name[0] | upper if user and user.name else 'U' }}
                        </div>
                        <span class="profile-name">{{ user.name if user else 'User' }}</span>
                        <i data-lucide="chevron-down" style="width: 16px; margin-left: 8px; opacity: 0.5;"></i>
                    </div>
                </a>

                <ul class="dropdown-menu dropdown-menu-end custom-dropdown-menu" aria-labelledby="profileDropdown">
                    <li>
                        <a class="dropdown-item d-flex align-items-center gap-2" href="{{ url_for('profile') }}">
                            <i data-lucide="user" style="width: 16px;"></i> My Profile
                        </a>
                    </li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                        <a class="dropdown-item d-flex align-items-center gap-2 text-danger" href="{{ url_for('logout') }}">
                            <i data-lucide="log-out" style="width: 16px;"></i> Logout
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="container mt-5 pt-5">
        <h1 class="display-3 fw-bold mb-4 mt-5">Phishing Scanner</h1>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            {% for category, message in messages %}
              <div class="alert alert-{{ 'danger' if category == 'danger' else 'success' }} mb-4" role="alert" style="border-radius: 20px;">
                 {{ message }}
              </div>
            {% endfor %}
          {% endif %}
        {% endwith %}

        <ul class="nav nav-tabs scanner-nav-tabs border-0" id="scannerTab" role="tablist">
            <li class="nav-item">
                <button class="nav-link {{ 'active' if mode == 'text' or not mode }}" onclick="switchMode('text')" data-bs-toggle="tab" data-bs-target="#text-pane">Text Scanner</button>
            </li>
            <li class="nav-item">
                <button class="nav-link {{ 'active' if mode == 'url' }}" onclick="switchMode('url')" data-bs-toggle="tab" data-bs-target="#link-pane">Link Scanner</button>
            </li>
            <li class="nav-item">
                <button class="nav-link {{ 'active' if mode == 'image' }}" onclick="switchMode('image')" data-bs-toggle="tab" data-bs-target="#image-pane">Image Scanner</button>
            </li>
        </ul>

        <div class="scanner-main-wrap mb-4">
            <div class="scanner-left-box tab-content" id="scannerTabContent">
                
                <div class="tab-pane fade {{ 'show active' if mode == 'text' or not mode }}" id="text-pane" role="tabpanel">
                    <form action="/scan/text" method="POST" class="h-100 d-flex flex-column">
                        <textarea name="text_content" class="scanner-field" placeholder="Insert Text Here" required>{{ request.form.text_content if mode == 'text' }}</textarea>
                        <div class="d-flex justify-content-end align-items-center p-4 gap-4">
                            <i data-lucide="trash-2" class="icon-action" onclick="document.querySelector('[name=text_content]').value = ''"></i>
                            <button type="submit" class="btn btn-scan rounded-pill px-5">SCAN</button>
                        </div>
                    </form>
                </div>

                <div class="tab-pane fade {{ 'show active' if mode == 'url' }}" id="link-pane" role="tabpanel">
                    <form action="/scan/url" method="POST" class="h-100 d-flex flex-column">
                        <textarea name="url_content" class="scanner-field" placeholder="Enter URL to scan..." required>{{ request.form.url_content if mode == 'url' }}</textarea>
                        <div class="d-flex justify-content-end align-items-center p-4 gap-4">
                            <i data-lucide="trash-2" class="icon-action" onclick="document.querySelector('[name=url_content]').value = ''"></i>
                            <button type="submit" class="btn btn-scan rounded-pill px-5">SCAN</button>
                        </div>
                    </form>
                </div>

                <div class="tab-pane fade {{ 'show active' if mode == 'image' }}" id="image-pane" role="tabpanel">
                    <form action="/scan/image" method="POST" enctype="multipart/form-data" class="h-100">
                        <div class="upload-frame">
                            <div class="upload-icon-no-border mb-3">
                                <i data-lucide="image-up"></i>
                            </div>
                            <input type="file" name="file_upload" id="fileInput" style="display: none;" accept=".jpg,.png,.jpeg" onchange="this.form.submit()">
                            <button type="button" class="btn btn-upload rounded-pill px-5 mb-2" onclick="document.getElementById('fileInput').click()">Upload</button>
                            <p class="small opacity-50">Accepted formats: .jpg, .png</p>
                            {% if extracted_text and mode == 'image' %}
                                <p class="small text-success mt-2">Image processed.</p>
                            {% endif %}
                        </div>
                    </form>
                </div>
            </div>
            
            <div class="scanner-right-glass d-none d-md-block">
                {% if result %}
                    <div class="h-100 d-flex flex-column align-items-center justify-content-center p-4">
                        
                        <div class="status-wrapper w-100 
                            {% if result.label == 'Safe' %} state-safe 
                            {% elif result.label == 'Suspicious' %} state-caution 
                            {% else %} state-unsafe {% endif %}">
                            
                            <div class="status-icon-circle">
                                <i data-lucide="
                                    {% if result.label == 'Safe' %} check 
                                    {% elif result.label == 'Suspicious' %} alert-triangle 
                                    {% else %} x {% endif %}">
                                </i>
                            </div>
                            
                            <h2 class="status-label">{{ result.label|upper }}</h2>
                            <span class="confidence-text">{{ result.confidence }}% Confidence</span>
                            
                            <div class="status-progress-bg">
                                <div class="status-progress-bar" id="resultBar" data-width="{{ result.confidence | default(0) }}"></div>
                            </div>
                        </div>

                        <div class="mt-4 w-100 text-start" style="max-height: 200px; overflow-y: auto; color: rgba(255,255,255,0.7);">
                            <h6 class="text-uppercase small fw-bold opacity-50 mb-2">Analysis Report</h6>
                            <ul class="list-unstyled small">
                                {% for detail in result.details %}
                                    <li class="mb-2"><i data-lucide="arrow-right" style="width:12px; display:inline;"></i> {{ detail }}</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                {% else %}
                    <div class="h-100 d-flex flex-column align-items-center justify-content-center opacity-25">
                        <i data-lucide="scan-line" style="width: 64px; height: 64px;"></i>
                        <p class="mt-3 fw-bold">Ready to Scan</p>
                    </div>
                {% endif %}
            </div>
        </div>

        <div class="disclaimer-bar mb-5">
            This detection engine provides probabilistic results based on trained patterns; it should be used as a supplementary defense rather than a definitive security guarantee.
        </div>

    </main>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
        lucide.createIcons();
        
        lucide.createIcons({
            attrs: { width: 140, height: 140, 'stroke-width': 1.2, color: 'white' },
            nameAttr: 'data-lucide-large' 
        });

        document.addEventListener("DOMContentLoaded", function() {
            const bar = document.getElementById('resultBar');
            if (bar) {
                const widthVal = bar.getAttribute('data-width');
                setTimeout(() => {
                    bar.style.width = widthVal + '%';
                }, 100);
            }
        });

        function switchMode(mode) {
            console.log("Switching to " + mode);
        }
    </script>
</body>
</html>